# Retrospective - Epic 3: Developer Workflow Integration & Tooling

**Date:** 2026-01-03
**Facilitator:** Bob (Scrum Master)
**Participants:** Minh (Project Lead), Alice (PO), Charlie (Sr Dev), Dana (QA), Elena (Jr Dev)

---

## Executive Summary

Epic 3 was a pivotal phase for `coretext`, transitioning the system from a background indexing engine to a tangible developer toolset. We successfully delivered a suite of CLI commands (`init`, `status`, `inspect`, `lint`, `new`) that provide humans and agents alike with visibility and control over the Knowledge Graph.

The epic was characterized by high developer autonomy and the successful application of the "User Demo Verified" principle established in Epic 1. However, implementation revealed significant "friction" in OS-level integration—specifically regarding process management, binary distribution, and background thread handling—which required robust architectural solutions like the "Port Guard" and lazy-loading embedders.

---

## Epic 3 Review

### Delivery Metrics
*   **Stories Completed:** 6 / 6 (100%)
*   **Key Deliverables:**
    *   `coretext init`: Automated environment setup (Binaries, Models, Config).
    *   `coretext status`: Real-time health monitoring of Daemon and DB.
    *   `coretext inspect`: Rich tree-based visualization of graph topology.
    *   `coretext lint`: Referential integrity and syntax checking.
    *   `coretext new`: BMAD-compliant template provisioning.
    *   `coretext stop/start`: Robust daemon lifecycle management.

### What Went Well
1.  **High Autonomy:** Architectural guardrails from Epic 1 allowed for smooth development with minimal intervention.
2.  **The "Verification Savior":** Story 3.6 (Demo & Verification) once again proved critical, flushing out bugs in process management and hook termination that unit tests missed.
3.  **UI/UX with Rich:** The transition to `Rich`-based terminal output significantly improved the "Loud Failures" experience, making the graph topology intuitive to inspect.
4.  **Resilience Patterns:** Implementation of the "Port Guard" and PID verification loops solved long-standing issues with zombie processes and port conflicts.

### Challenges & Lessons Learned
1.  **OS Integration Friction:**
    *   *Issue:* Background threads from PyTorch (SentenceTransformer) caused Git hooks to hang indefinitely.
    *   *Lesson:* Be wary of "heavy" dependencies in hooks. Lazy loading and explicit process exits (`os._exit(0)`) are necessary for clean termination.
2.  **The "Perfect Mock" Trap:**
    *   *Issue:* Unit tests passed, but the actual binary download and process spawning failed in real environments (especially macOS archive formats).
    *   *Lesson:* Integration testing must account for the "friction" of the OS, not just the logic of the code.
3.  **Agent-Centric Bias:**
    *   *Issue:* Development focused heavily on terminal commands, potentially ignoring the human need for more interactive debugging.
    *   *Lesson:* Shift focus to "Interactive Debugging" and "Creative Edge Cases" to ensure a robust human-machine partnership.

---

## Action Plan & Commitments

### Process Changes for Epic 4

1.  **Story 4.5: Stress Testing & Chaos Engineering:**
    *   **New Requirement:** Explicitly test the system's survival under failure conditions (Process kills, high load, corrupted state).
2.  **Interactive Debugging Requirement:**
    *   **Requirement:** Every feature must expose enough diagnostic info (logs, status) for a human to debug without source code access.

### Technical Debt Addressal (Epic 4 Focus)
*   **Async Mode (Debt: Concurrency):** Story 4.1 will implement a robust async hook model to prevent race conditions.
*   **Self-Healing (Debt: Ghost Nodes):** Story 4.4 will implement automatic pruning of deleted/renamed nodes.
*   **Relaxed Parsing:** Parser will be updated in Story 4.4 to support "future links" (references to not-yet-created files).
*   **Deferred:** UUID migration for Node IDs is acknowledged but deferred to prioritize a working prototype.

---

## Next Steps

1.  **Execute Preparation Sprint:** Focus on async process management research.
2.  **Initialize Epic 4 Planning:** Incorporate Story 4.5 (Stress Test) into the backlog.
3.  **Target Prototype:** Epic 4 is the final push for a production-ready prototype.

**Meeting Adjourned.**
